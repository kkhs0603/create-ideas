{"ast":null,"code":"var _jsxFileName = \"/Users/kakehashishunsuke/create-ideas/src/contexts/CanvasContext.js\";\nvar __jsx = React.createElement;\nimport React, { useState, createContext, useEffect } from \"react\";\nimport firebase from \"../firebase/firebase\";\nconst CanvasContext = /*#__PURE__*/createContext();\nconst db = firebase.firestore();\n\nconst CanvasProvider = ({\n  children\n}) => {\n  const {\n    0: canvases,\n    1: setCanvases\n  } = useState([]);\n  const {\n    0: canvasName,\n    1: setCanvasName\n  } = useState(\"\");\n  const {\n    0: joinedUsers,\n    1: setJoinedUsers\n  } = useState([]);\n  const {\n    0: canvasIds,\n    1: setCanvasIds\n  } = useState([]);\n  const auth = firebase.auth(); /////////\n  ///canvas\n  /////////\n\n  const createCanvas = async () => {\n    try {\n      const userDoc = await db.collection(\"users\").doc(auth.currentUser.uid).get();\n      const userData = userDoc.data();\n      console.log(userData); //canvases\n\n      const timestamp = firebase.firestore.Timestamp.now();\n      await db.collection(\"canvases\").add({\n        name: canvasName,\n        words: [],\n        ideas: [],\n        joined_users: [],\n        created_at: timestamp,\n        created_by: auth.currentUser.uid,\n        updated_at: timestamp\n      });\n      console.log(\"new canvas created!\");\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const getCanvases = async () => {\n    try {\n      const canvasesRef = await db.collection(\"canvases\");\n      canvasesRef.onSnapshot(snapshot => {\n        snapshot.docs.forEach(change => {\n          const date = change.data().created_at.toDate();\n          setCanvases(values => [...values, {\n            id: change.id,\n            name: change.data().name,\n            created_by: change.data().created_by,\n            created_at: date\n          }]);\n        });\n      });\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const handleCanvasName = event => {\n    console.log(event.target.value);\n    setCanvasName(event.target.value);\n  };\n\n  const enterCanvas = async canvasId => {\n    try {\n      //firebase canvasesのコレクションから参加しているユーザーID取得\n      setJoinedUsers([]);\n      const canvasesRef = await db.collection(\"canvases\").doc(canvasId);\n      const joinedUserIds = (await canvasesRef.get()).data().joined_users;\n      const myUserId = auth.currentUser.uid;\n\n      if (!joinedUserIds.includes(myUserId)) {\n        joinedUserIds.push(myUserId);\n        canvasesRef.update({\n          joined_users: joinedUserIds\n        });\n      } //取得したユーザーIDからユーザー情報取得\n\n\n      joinedUserIds.map(async userId => {\n        const usersRef = db.collection(\"users\").doc(userId);\n        const userdata = (await usersRef.get()).data();\n        setJoinedUsers(user => [...user, userdata]);\n      });\n      await canvasesRef.onSnapshot(snapshot => {\n        if (snapshot.data().created_by !== auth.currentUser.uid) {// console.log(\"not authoer\");\n        } else {// console.log(\"author\");\n          }\n      });\n    } catch (error) {\n      console.log(error.message);\n    }\n  };\n\n  useEffect(() => {\n    auth.onAuthStateChanged(user => {\n      if (user) {\n        getCanvases();\n      }\n    });\n  }, [auth]);\n  return __jsx(CanvasContext.Provider, {\n    value: {\n      createCanvas,\n      canvases,\n      handleCanvasName,\n      enterCanvas,\n      joinedUsers\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 5\n    }\n  }, children);\n};\n\nexport { CanvasContext, CanvasProvider };","map":{"version":3,"sources":["/Users/kakehashishunsuke/create-ideas/src/contexts/CanvasContext.js"],"names":["React","useState","createContext","useEffect","firebase","CanvasContext","db","firestore","CanvasProvider","children","canvases","setCanvases","canvasName","setCanvasName","joinedUsers","setJoinedUsers","canvasIds","setCanvasIds","auth","createCanvas","userDoc","collection","doc","currentUser","uid","get","userData","data","console","log","timestamp","Timestamp","now","add","name","words","ideas","joined_users","created_at","created_by","updated_at","error","getCanvases","canvasesRef","onSnapshot","snapshot","docs","forEach","change","date","toDate","values","id","handleCanvasName","event","target","value","enterCanvas","canvasId","joinedUserIds","myUserId","includes","push","update","map","userId","usersRef","userdata","user","message","onAuthStateChanged"],"mappings":"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","sourcesContent":["import React, { useState, createContext, useEffect } from \"react\";\nimport firebase from \"../firebase/firebase\";\nconst CanvasContext = createContext();\nconst db = firebase.firestore();\nconst CanvasProvider = ({ children }) => {\n  const [canvases, setCanvases] = useState([]);\n  const [canvasName, setCanvasName] = useState(\"\");\n  const [joinedUsers, setJoinedUsers] = useState([]);\n  const [canvasIds, setCanvasIds] = useState([]);\n  const auth = firebase.auth();\n\n  /////////\n  ///canvas\n  /////////\n  const createCanvas = async () => {\n    try {\n      const userDoc = await db\n        .collection(\"users\")\n        .doc(auth.currentUser.uid)\n        .get();\n      const userData = userDoc.data();\n      console.log(userData);\n      //canvases\n      const timestamp = firebase.firestore.Timestamp.now();\n      await db.collection(\"canvases\").add({\n        name: canvasName,\n        words: [],\n        ideas: [],\n        joined_users: [],\n        created_at: timestamp,\n        created_by: auth.currentUser.uid,\n        updated_at: timestamp,\n      });\n      console.log(\"new canvas created!\");\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const getCanvases = async () => {\n    try {\n      const canvasesRef = await db.collection(\"canvases\");\n      canvasesRef.onSnapshot((snapshot) => {\n        snapshot.docs.forEach((change) => {\n          const date = change.data().created_at.toDate();\n          setCanvases((values) => [\n            ...values,\n            {\n              id: change.id,\n              name: change.data().name,\n              created_by: change.data().created_by,\n              created_at: date,\n            },\n          ]);\n        });\n      });\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const handleCanvasName = (event) => {\n    console.log(event.target.value);\n    setCanvasName(event.target.value);\n  };\n\n  const enterCanvas = async (canvasId) => {\n    try {\n      //firebase canvasesのコレクションから参加しているユーザーID取得\n      setJoinedUsers([]);\n      const canvasesRef = await db.collection(\"canvases\").doc(canvasId);\n      const joinedUserIds = (await canvasesRef.get()).data().joined_users;\n      const myUserId = auth.currentUser.uid;\n      if (!joinedUserIds.includes(myUserId)) {\n        joinedUserIds.push(myUserId);\n        canvasesRef.update({ joined_users: joinedUserIds });\n      }\n      //取得したユーザーIDからユーザー情報取得\n      joinedUserIds.map(async (userId) => {\n        const usersRef = db.collection(\"users\").doc(userId);\n        const userdata = (await usersRef.get()).data();\n        setJoinedUsers((user) => [...user, userdata]);\n      });\n      await canvasesRef.onSnapshot((snapshot) => {\n        if (snapshot.data().created_by !== auth.currentUser.uid) {\n          // console.log(\"not authoer\");\n        } else {\n          // console.log(\"author\");\n        }\n      });\n    } catch (error) {\n      console.log(error.message);\n    }\n  };\n\n  useEffect(() => {\n    auth.onAuthStateChanged((user) => {\n      if (user) {\n        getCanvases();\n      }\n    });\n  }, [auth]);\n\n  return (\n    <CanvasContext.Provider\n      value={{\n        createCanvas,\n        canvases,\n        handleCanvasName,\n        enterCanvas,\n        joinedUsers,\n      }}\n    >\n      {children}\n    </CanvasContext.Provider>\n  );\n};\n\nexport { CanvasContext, CanvasProvider };\n"]},"metadata":{},"sourceType":"module"}