{"ast":null,"code":"var _jsxFileName = \"/Users/kakehashishunsuke/create-ideas/src/contexts/AuthContext.js\";\nvar __jsx = React.createElement;\nimport React, { useState, createContext, useEffect } from \"react\";\nimport firebase from \"../firebase/firebase\";\nimport ErrorMessage from \"../firebase/ErrorMessage.js\";\nimport { useHistory } from \"react-router-dom\";\nconst AuthContext = /*#__PURE__*/createContext();\n\nconst AuthProvider = ({\n  children\n}) => {\n  const {\n    0: user,\n    1: setUser\n  } = useState(null);\n  const auth = firebase.auth();\n  const history = useHistory();\n  const db = firebase.firestore(); //TODO:reducerを通してstateを変更するように\n\n  const signinWithEmailAndPassword = async (email, password) => {\n    try {\n      await auth.signInWithEmailAndPassword(email, password);\n    } catch (error) {\n      return ErrorMessage(error, \"signin\");\n    }\n  };\n\n  const signupWithEmailAndPassword = async (email, password, userName) => {\n    try {\n      const result = await auth.createUserWithEmailAndPassword(email, password);\n      await result.user.updateProfile({\n        displayName: userName\n      });\n      return result;\n    } catch (error) {\n      return ErrorMessage(error, \"signup\");\n    }\n  };\n\n  const signinWithGoogle = async () => {\n    try {\n      await auth.signInWithRedirect(googleProvider);\n    } catch (e) {\n      return ErrorMessage(e, \"signin\");\n    }\n  };\n\n  const signout = async () => {\n    try {\n      await auth.signOut();\n      console.log(\"sign out\");\n    } catch (e) {\n      return ErrorMessage(e, \"signout\");\n    }\n  };\n\n  const updateUser = async (userId, name, imageUrl) => {\n    try {\n      await db.collection(\"users\").doc(userId).update({\n        name: name,\n        image_url: imageUrl\n      });\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const handleGoUserSetting = () => {\n    history.push(\"/settings\");\n  };\n\n  const handleGoBack = () => {\n    history.goBack();\n  }; //TODO:直接書く、handleはいらない\n\n\n  const handleGoCanvas = id => {\n    history.push({\n      pathname: \"/canvas\",\n      state: {\n        canvasId: id\n      }\n    });\n  };\n\n  useEffect(() => {\n    auth.onAuthStateChanged(async user => {\n      if (user == null) {\n        setUser(null);\n        localStorage.clear();\n        return;\n      }\n\n      setUser(user);\n      const userRef = await db.collection(\"users\").doc(user.uid);\n\n      if (!userRef.get().exists) {\n        const timestamp = firebase.firestore.Timestamp.now();\n        await userRef.set({\n          id: user.uid,\n          name: user.displayName,\n          image_url: user.photoURL,\n          created_at: timestamp,\n          updated_at: timestamp\n        });\n      }\n\n      history.push(\"/canvas-list\");\n    });\n  }, [auth]);\n  return __jsx(AuthContext.Provider, {\n    value: {\n      signinWithGoogle,\n      signout,\n      signupWithEmailAndPassword,\n      signinWithEmailAndPassword,\n      user,\n      handleGoUserSetting,\n      handleGoBack,\n      handleGoCanvas,\n      updateUser\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 5\n    }\n  }, children);\n};\n\nexport { AuthContext, AuthProvider };","map":{"version":3,"sources":["/Users/kakehashishunsuke/create-ideas/src/contexts/AuthContext.js"],"names":["React","useState","createContext","useEffect","firebase","ErrorMessage","useHistory","AuthContext","AuthProvider","children","user","setUser","auth","history","db","firestore","signinWithEmailAndPassword","email","password","signInWithEmailAndPassword","error","signupWithEmailAndPassword","userName","result","createUserWithEmailAndPassword","updateProfile","displayName","signinWithGoogle","signInWithRedirect","googleProvider","e","signout","signOut","console","log","updateUser","userId","name","imageUrl","collection","doc","update","image_url","handleGoUserSetting","push","handleGoBack","goBack","handleGoCanvas","id","pathname","state","canvasId","onAuthStateChanged","localStorage","clear","userRef","uid","get","exists","timestamp","Timestamp","now","set","photoURL","created_at","updated_at"],"mappings":"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","sourcesContent":["import React, { useState, createContext, useEffect } from \"react\";\nimport firebase from \"../firebase/firebase\";\nimport ErrorMessage from \"../firebase/ErrorMessage.js\";\nimport { useHistory } from \"react-router-dom\";\n\nconst AuthContext = createContext();\n\nconst AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const auth = firebase.auth();\n  const history = useHistory();\n  const db = firebase.firestore();\n  //TODO:reducerを通してstateを変更するように\n  const signinWithEmailAndPassword = async (email, password) => {\n    try {\n      await auth.signInWithEmailAndPassword(email, password);\n    } catch (error) {\n      return ErrorMessage(error, \"signin\");\n    }\n  };\n\n  const signupWithEmailAndPassword = async (email, password, userName) => {\n    try {\n      const result = await auth.createUserWithEmailAndPassword(email, password);\n      await result.user.updateProfile({ displayName: userName });\n      return result;\n    } catch (error) {\n      return ErrorMessage(error, \"signup\");\n    }\n  };\n\n  const signinWithGoogle = async () => {\n    try {\n      await auth.signInWithRedirect(googleProvider);\n    } catch (e) {\n      return ErrorMessage(e, \"signin\");\n    }\n  };\n\n  const signout = async () => {\n    try {\n      await auth.signOut();\n      console.log(\"sign out\");\n    } catch (e) {\n      return ErrorMessage(e, \"signout\");\n    }\n  };\n\n  const updateUser = async (userId, name, imageUrl) => {\n    try {\n      await db\n        .collection(\"users\")\n        .doc(userId)\n        .update({ name: name, image_url: imageUrl });\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const handleGoUserSetting = () => {\n    history.push(\"/settings\");\n  };\n\n  const handleGoBack = () => {\n    history.goBack();\n  };\n\n  //TODO:直接書く、handleはいらない\n  const handleGoCanvas = (id) => {\n    history.push({ pathname: \"/canvas\", state: { canvasId: id } });\n  };\n\n  useEffect(() => {\n    auth.onAuthStateChanged(async (user) => {\n      if (user == null) {\n        setUser(null);\n        localStorage.clear();\n        return;\n      }\n      setUser(user);\n      const userRef = await db.collection(\"users\").doc(user.uid);\n      if (!userRef.get().exists) {\n        const timestamp = firebase.firestore.Timestamp.now();\n        await userRef.set({\n          id: user.uid,\n          name: user.displayName,\n          image_url: user.photoURL,\n          created_at: timestamp,\n          updated_at: timestamp,\n        });\n      }\n      history.push(\"/canvas-list\");\n    });\n  }, [auth]);\n\n  return (\n    <AuthContext.Provider\n      value={{\n        signinWithGoogle,\n        signout,\n        signupWithEmailAndPassword,\n        signinWithEmailAndPassword,\n        user,\n        handleGoUserSetting,\n        handleGoBack,\n        handleGoCanvas,\n        updateUser,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport { AuthContext, AuthProvider };\n"]},"metadata":{},"sourceType":"module"}